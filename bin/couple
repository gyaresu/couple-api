#!/usr/bin/env node

'use strict';

var prompt = require('prompt');
var program = require('commander');
var Couple = require('../lib/couple.js');

var couple = new Couple();

program
  .version('0.0.1');

program
  .command('auth [email] [password]')
  .description('Authenticate with target Couple account.')
  .action(function(em, pass, options){
    var email = em || process.env.COUPLE_EMAIL || null;
    var password = pass || process.env.COUPLE_PASSWORD || null;
    if(!email || !password){
      return console.log('Please provide the email and password of the target Couple account.');
    }
    //var couple = new Couple();
    couple.authenticate(email, password, function(err, resObj){
      if(err) {
        console.error(err);
      }
      console.log(couple.identify());
    });
  });

program
  .command('download <type>')
  .description('Download images and videos to ./private/{type}')
  .action(function(type) {
    if(!this.authObject){
      prompt.start();
      prompt.get(['email', 'password'], function (err, result) {
        couple.authenticate(result.email, result.password, function (err, resObj) {
          if (err) {
            console.error('There was an error authenticating: ' + err);
          }
          console.log('Authentication successful for user: ', couple.authObject.user.userName);
          couple.download(type, function (err) {
            if (err) {
              console.error(err);
            }
            //console.log('Downloads successful');
          });
        });
      });
    }
  });

program.parse(process.argv);

if(!program.args.length) {
    program.help();
}
